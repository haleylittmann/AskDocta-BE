{% extends "base.html" %}

{% block content %}
<div class="py-5">
    <div class="container">
    <h2>Sorting:</h2>
    <a class="btn btn-light" href="?order_by=severity&direction=desc" role="button">Severity ↓</a>
    <a class="btn btn-light" href="?order_by=severity&direction=asc" role="button">Severity ↑</a>
    <a class="btn btn-light" href="?order_by=created_at&direction=desc" role="button">Created ↓</a>
    <a class="btn btn-light" href="?order_by=created_at&direction=asc" role="button">Created ↑</a>
    <a class="btn btn-light" href="?order_by=start&direction=desc" role="button">Start ↓</a>
    <a class="btn btn-light" href="?order_by=start&direction=asc" role="button">Start ↑</a>
    <br>
    <br>
    <form method="post">
        {% csrf_token %}{{ sort_form.issue.errors }} 
          <label for="{{ sort_form.issue.id_for_label }}">Issue:</label>
          {{ sort_form.issue }} 
      <button class="btn btn-light" type="submit">Sort</button>
    </form>
    <br>
    <h1>Requests:</h1>
    {% if patients %}
        {% for p in patients %}
          <div class="row py-2 border-top bordert-bottom border-light">
            <div class="col-md-8">
              <div class="row">
                <div class="col-md-6">
                  <h6 class=""><b>Name:</b> {{ p.first_name }} {{ p.last_name }}</h6>
                </div>
                <div class="col-md-6">
                  <h6><b>Sex</b> {{ p.sex }}</h6>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6">
                  <h6 class="">Current Issue: {{ issue_dict|get_item:p.issue }} {% if p.other_issue %}| Details: {{ p.other_issue }}{% endif %}</h6>
                </div>
                <div class="col-md-6">
                  <h6><b>Severity:</b> 
                  {% if p.severity == 1%}
                  Low
                  {% elif p.severity == 2%}
                  Medium
                  {% elif p.severity == 3%}
                  High
                  {% endif %}</h6>
                </div>
              </div>
              <div class="row">
                {% if p.start %}
                <h6 class="">Start of Issue: {{ p.start }}</h6>
                {% endif %}
                {% if p.start_details %}
                <h6 class="">Start of Issue: {{ p.start_deatils }}</h6>
                {% endif %}
              </div>
              <div class="row">
                <div class="col-md-6">
                  <h6 class="">Height: {{ p.height }} cm</h6>
                </div>
                <div class="col-md-6">
                  <h6><b>Weight</b> {{ p.weight }} kg</h6>
                </div>
              </div>
              <div class="row">
                <div class="col-md-12">
                  <h6 class="">Allergies: {{ p.allergies }}
                    {% if p.other_allergy %}
                    , {{ p.other_allergy }}
                    {% endif %}
                  </h6>
                  {% if p.curr_meds %}
                  <h6 class="">Current Medications: {{ p.curr_meds }}</h6>
                  {% endif %}
                  {% if p.med_hist %}
                  <h6 class="">Medical History: {{ p.med_hist }}</h6>
                  {% endif %}
                  {% if p.other_hist %}
                  <h6 class="">Other History: {{ p.other_hist }}</h6>
                  {% endif %}
                  {% if p.fam_hist %}
                  <h6 class="">Family History: {{ p.fam_hist }}</h6>
                  {% endif %}
                  <h6 class="">Smoke:
                  {% if p.smoke == "N"%}
                  None
                  {% elif p.smoke == "F"%}
                  Former
                  {% elif p.smoke == "S"%}
                  Some Days
                  {% else %}
                  Most/Every Day
                  {% endif %}
                   | Alcohol: 
                  {% if p.alc == "N"%}
                  None
                  {% elif p.alc == "O"%}
                  Occasional
                  {% else %}
                  Frequent
                  {% endif %}
                  </h6>
                  <h6 class="">Request Created: {{ p.created_at }}</h6>
              </div>
            </div>
          </div>
            <div class="col-md-4">
                <form action="/request/{{p.id}}" method="post">
                    {% csrf_token %}
                    <input type="hidden" name="grab" value="1">
                    <button type="submit" class="btn btn-lg btn-block btn-secondary">Accept Request</button>
                </form>
            </div> 
          </div>
        {% endfor %}
    {% else %}
        <h4>There are no outstanding requests.</h4>
    {% endif %}
    </div>
</div>        
{% endblock content %}